@model DiscussionViewModel

@{
    ViewData["Title"] = $"{Model.Discussion.Name}-MF Forum";
}

<script src="~/js/ckeditor/ckeditor.js" type="text/javascript"></script>



<div>

    <div width="100%" ;>
        @if (Model.Discussion != null)
        {


            <div class="row forBorder">

                <div class="col-sm-2 bg-dark">

                    <div class="row ">
                        @if (Model.Discussion.User.Avatar != null)
                        {
                            <img style='width:100%; max-height:140px;' src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.Discussion.User.Avatar))" />
                        }
                    </div>
                    <div class="row text-light">
                        @Model.Discussion.User.UserName
                    </div>
                    <div class="row text-light">
                        @Model.Discussion.Date
                    </div>
                </div>

                <div class="col-sm-10 ">
                   
                        <p>
                            <h3 style="display:block"> @($"{ @Model.Discussion.Name}")</h3>
                        </p>

                        <p class="discussionDescription">@($"{ @Model.Discussion.Description}")</p>
                


                </div>


            </div>

            <br />

           
        @foreach (Message message in Model.Discussion.Messages)
        {


            <div id="PlaceHolderHere">
                <input type="hidden" class="currentUrl" value="@ViewBag.Url">
                @*
                <input type="hidden" id="message" value="@message.Text">*@
            </div>
            <div class="row forBorder">

                <div class="col-sm-2 bg-dark">

                    <div class="row ">
                        @if (message.User.Avatar != null)
                        {
                            <img style='width:100%; max-height:140px;' src="data:image/jpeg;base64,@(Convert.ToBase64String(message.User.Avatar))" />
                        }
                    </div>
                    <div class="row text-light">
                        @message.User.UserName
                    </div>
                    <div class="row text-light">
                        @message.Date
                    </div>
                </div>

                <div class="col-sm-10 ">
                   
                        <p id="text @message.Id" >@($"{ message.Text}")</p>

                    


                    @*//редактировать сообщение может тольок тот кто его написал*@
                    @if (message.UserId == Model.UserId)
                    {
                        <div class="row ">
                            <a  id="@message.Id" href="#" type="button" data-toggle="ajax-model" data-target="#editMessage"
                               data-url="@Url.Action("Edit","Messages",new { area = "User" })">
                                Edit
                            </a>

                        </div>
                        <br />
                    }
                </div>


            </div>

        }
        <br />
        <form id="myForm" asp-area="User" asp-controller="Messages" asp-action="Create" method="post">

            <input class="currentId" type="hidden" name="redirectUrl" value="@ViewBag.Url ">
            <div class="row">



                <div class="form-group">
                    <input id="addMessage" class="btn btn-primary" type="submit" value="Add a new message" />
                </div>



            </div>
            <div class="row ">

                <div class="col-sm-12 ">

                    <textarea name="commentText" id="comment"></textarea>
                </div>

            </div>
        </form>
        <br />
    }





    </div>
</div>

<script type="text/javascript">CKEDITOR.replace('comment');</script>
